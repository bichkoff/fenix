
(function(){var g=document;var k="";var a;var e={selects:["country","region","town","hotel","contract","offer","button"],country:{num:0,val:"1"},region:{num:1,val:0,response:{},setData:function(){return{id:this.val}},onChange:function(d){this.val=d.value;j("contract");j("offer");i(this);l(e.selects[2]).removeAttribute("disabled");if(typeof(this.response[this.val])==="undefined"){return f(this)}else{this.createOptions(this.response[this.val])}},createOptions:function(o){this.response[this.val]=o;var n=e.getNext(this);j(n);for(var d in o){$("#"+n).append("<option value='"+o[d]+"'>"+d+"</option>")}}},town:{num:2,list:"<option value='0'>Select Town…</option>",val:"",response:{},setData:function(){return{id:this.val}},onChange:function(d){this.val=d.value;j("contract");j("offer");i(this);if(this.val==="0"){return}if(typeof(this.response[this.val])==="undefined"){return f(this)}else{this.createOptions(this.response[this.val])}},createOptions:function(o){this.response[this.val]=o;var n=e.getNext(this);j(n);for(var d in o){$("#"+n).append("<option value='"+o[d]+"'>"+d+"</option>")}}},hotel:{num:3,list:"<option value='0'>Pick up a Hotel…</option>",val:"",name:"",response:{},setData:function(){return{id:this.val}},onChange:function(d){this.val=d.value;j("offer");i(this);if(this.val==="0"){return}if(typeof(this.response[this.val])==="undefined"){return f(this)}else{this.createOptions(this.response[this.val])}},createOptions:function(o){this.response[this.val]=o;var n=e.getNext(this);j(n);for(var d in o){$("#"+n).append("<option value='"+d+"'>Season: "+o[d][0]+". Valid: "+o[d][1]+"—"+o[d][2]+"</option>")}}},contract:{num:4,list:"<option value='0'>Pick up a Contract…</option>",val:"",response:{},setData:function(){return{ids:[e.country.val,e.town.val,e.hotel.val,this.val]}},onChange:function(d){this.val=d.value;i(this);if(this.val==="0"||this.val==="-1"){return}if(typeof(this.response[this.val])==="undefined"){return f(this)}else{this.createOptions(this.response[this.val])}},createOptions:function(o){this.response[this.val]=o;var n=e.getNext(this);j(n);$("#"+n).append("<option value='-1'>Contract Rates</option>");for(var d in o){$("#"+n).append("<option value='"+d+"'>"+o[d][0]+". Valid: "+o[d][1]+"—"+o[d][2]+", book: "+o[d][3]+"—"+o[d][4]+" "+o[d][5]+"</option>")}}},offer:{num:5,list:"<option value='0'>Select an Offer…</option>",val:"",onChange:function(d){this.val=d.value;i(this);return true}},button:{num:6,val:"",setData:function(){return{ids:[e.country.val,e.town.val,e.hotel.val,e.contract.val,e.offer.val],hotelname:e.hotel.name}},onCreate:function(){f(this)},createOptions:function(d){$("#content").html(d)}},getVal:function(d){return this[d].val},getNext:function(n){if(typeof(n)==="object"&&typeof(n.num)!=="undefined"){var d=n.num+1;return this.selects[d]}return false}};var m={form:null,hotel:{num:1,val:0,onChange:function(d){this.val=d.value}},from:{num:2,val:"",onChange:function(d){this.val=d.value}},to:{num:3,val:"",onChange:function(d){this.val=d.value},setVal:function(d){this.val=d}},button:{num:4,val:"",setData:function(){return{ids:[m.hotel.val,m.from.val,m.to.val,]}},onCreate:function(){f(this)},createOptions:function(d){$("#content").html(d)}},setForm:function(d){this.form=d}};function l(d){return g.getElementById(d)}function i(o){var d=o.val==="0"?o.num:o.num+1;l(e.selects[d]).removeAttribute("disabled");for(var n=d+1;n<e.selects.length;n++){l(e.selects[n]).setAttribute("disabled","disabled")}}var c=function(d){return $.ajax({method:"POST",url:k+a,dataType:"json",data:d.setData()})};function f(n){var d=c(n);$("#loader").addClass("loading");d.done(function(o){if(o.status==="success"){if(o.substatus==="expired"||o.substatus==="wrongdata"){$("#excelbtn").hide()}n.createOptions(o.data)}else{if(o.status==="error"){alert("Error.")}}$("#loader").removeClass("loading")});d.fail(function(o,p){alert("Request failed: "+p);$("#loader").removeClass("loading")})}function j(d){$("#"+d+" option").remove();$("#"+d).append(e[d].list)}function h(d){if(d.from.value===""||d.to.value===""){return false}return true}var b=function(){return{f:f1,tmp:"value of tmp"}};b.a="Func";b.onChange=function(n,d){var o=n.id;a=d;$("#content").html("");$("#excelbtn").hide();return e[o].onChange(n)};b.onChangeSs=function(d){var n=d.id;$("#content").html("");$("#excelbtn").hide();return m[n].onChange(d)};b.onCreate=function(d){a=d;e.hotel.name=$("#hotel option:selected").text();$("#excelbtn").show();e.button.onCreate()};b.getSls=function(){return e};b.getSs=function(){return m};b.getVal=function(d){return e[d].val};b.setUrlPrefix=function(d){k=d};b.loadDatepicker=function(d){var n=new Date();var o=n.getFullYear()+3;$("."+d).datepicker({showOn:"both",buttonImage:k+"/images/ui/calendar.gif",buttonImageOnly:true,showOtherMonths:true,selectOtherMonths:true,firstDay:1,dateFormat:"dd.mm.yy",changeMonth:true,changeYear:true,yearRange:"2016:"+o});$("."+d).inputmask("99.99.2099")};b.initDp=function(n,d){$("#"+n).change(function(){if($("#"+d).val()===""){$("#"+d).val($("#"+n).val());m.to.setVal($("#"+d).val())}})};b.onFormSubmit=function(d,n){if(!h(d)){alert("Ошибка. Форма не заполнена.");return false}a=n;m.setForm(d);$("#excelbtn").show();m.button.onCreate()};this.fenix=b})();